---
  - name: Create consul-template config
    template: src=consulagent.conf dest="{{ consul_template_config_file }}"

  - name: Create Consul bin dir
    file: path={{ inf_app_path }}/consul-template/bin state=directory

  - name: Install consul-template
    copy: src="/usr/nano/build/{{ ansible_environment}}/consul-template/bin/consul-template" mode=744 dest="{{ inf_app_path }}consul-template/bin/consul-template"

  - name: Create consul-template config folder
    file: path={{ consul_config_dir }} state=directory

  - name: Install consul-tempplate init.d script
    template: src=consul-template.init.d mode=744 dest=/etc/init.d/consul-template

  - name: Run insserv to install service
    command: /sbin/insserv -f consul-template

  - name: Start consul-template service
    command: /etc/init.d/consul-template start
